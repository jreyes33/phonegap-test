// Generated by CoffeeScript 1.3.3
(function() {
  var $, onContactError, onContactSuccess, updateCount, updateList;

  $ = jQuery;

  updateCount = function() {
    switch ($('#show-filter-fieldset :checked').val()) {
      case 'all':
        return $('#count-info').text("" + ($('#valid-contacts li :checked').length) + " de " + ($('#valid-contacts li :checkbox').length));
      case 'only-checked':
        return $('#count-info').text("" + ($('#valid-contacts li :checkbox:visible').length));
      case 'only-unchecked':
        return $('#count-info').text("" + ($('#valid-contacts li :checkbox:visible').length));
    }
  };

  updateList = function() {
    $('#valid-contacts li, #valid-contacts li .ui-checkbox').show();
    switch ($('#show-filter-fieldset :checked').val()) {
      case 'only-checked':
        $('#valid-contacts li :checkbox:not(:checked)').parents('.ui-checkbox').hide();
        break;
      case 'only-unchecked':
        $('#valid-contacts li :checkbox:checked').parents('.ui-checkbox').hide();
    }
    $('#valid-contacts li:not(:has(.ui-checkbox:visible))').hide();
    return updateCount();
  };

  onContactSuccess = function(contacts) {
    var $contact, $contactsList, checked, contact, i, number, _i, _j, _len, _len1, _ref;
    $contactsList = $();
    if (contacts != null) {
      for (_i = 0, _len = contacts.length; _i < _len; _i++) {
        contact = contacts[_i];
        if (contact.name == null) {
          continue;
        }
        $contact = $("<li>\n  <h3>" + contact.name.formatted + "</h3>\n  <fieldset data-role=\"controlgroup\" data-mini=\"true\"></fieldset>\n</li>");
        if (contact.phoneNumbers != null) {
          _ref = contact.phoneNumbers;
          for (i = _j = 0, _len1 = _ref.length; _j < _len1; i = ++_j) {
            number = _ref[i];
            switch (new PhoneNumber(number.value).isUpdatableEcuadorianMobile()) {
              case 'yes':
                checked = 'checked';
                break;
              case 'maybe':
                checked = '';
                break;
              case 'no':
                continue;
            }
            $contact.children('fieldset').append("<label>\n  <input type=\"checkbox\" name=\"checkbox[" + contact.id + "][" + i + "]\" " + checked + " data-theme=\"b\">\n  [" + contact.id + "][" + i + "] " + number.type + ": " + number.value + "\n</label>");
          }
          if ($contact.find('label').length) {
            $contactsList = $contactsList.add($contact);
          }
        }
      }
    }
    if ($contactsList.length) {
      $('#valid-contacts').append($contactsList.tsort());
      return updateCount();
    } else {
      return $('#contacts-content').html('<p>No se cargó ningún contacto.</p>');
    }
  };

  onContactError = function(err) {
    return $('#contacts-content').html("<p>Error al cargar los contactos: " + err.code + "</p>");
  };

  $(document).on('deviceready', function() {
    return navigator.contacts.find(["*"], onContactSuccess, onContactError);
  });

  /*
   * jQuery Mobile events
  */


  $(document).on('mobileinit', function() {
    $.mobile.ajaxEnabled = false;
    $.mobile.buttonMarkup.hoverDelay = 100;
    $.mobile.defaultPageTransition = 'none';
    return $.mobile.pushStateEnabled = false;
  });

  $(document).on('pageinit', function() {
    $('#contacts').on('change', '#valid-contacts li :checkbox', updateCount);
    return $('#contacts').on('change', '#show-filter-fieldset input', updateList);
  });

  $(document).on('pagechange', function() {});

}).call(this);
